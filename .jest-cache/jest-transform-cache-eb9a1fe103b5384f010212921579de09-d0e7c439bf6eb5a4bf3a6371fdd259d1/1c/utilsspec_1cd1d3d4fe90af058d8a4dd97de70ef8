84850caddf58b665142004046ff600d5
"use strict";

jest.mock('fs', function () {
  return {
    writeFile: jest.fn(function (path, data, options, cb) {
      // 1st arg passed to callback is the error
      cb(true);
    })
  };
});

var _fs = _interopRequireDefault(require("fs"));

var _utils = require("../src/utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-disable max-params */

/* eslint-disable no-console */
global.console = {
  log: jest.fn(),
  error: jest.fn()
};
describe('getDefaultRequestOptions', function () {
  it('uses default limit, start, and userAgent when none of those are passed', function () {
    var requestOptions = (0, _utils.getDefaultRequestOptions)({
      query: 'foo'
    });
    expect(requestOptions).toEqual({
      url: 'https://www.google.com/search',
      qs: {
        q: 'foo',
        num: _utils.defaultLimit,
        start: _utils.defaultStart
      },
      headers: {
        'User-Agent': _utils.defaultUserAgent
      }
    });
  });
});
describe('getTitleSelector', function () {
  it('uses the default value when passedValue is null/undefined and the env var does not exist', function () {
    expect((0, _utils.getTitleSelector)()).toBe(_utils.titleSelector);
  });
});
describe('getLinkSelector', function () {
  it('uses the default value when passedValue is null/undefined and the env var does not exist', function () {
    expect((0, _utils.getLinkSelector)()).toBe(_utils.linkSelector);
  });
});
describe('getSnippetSelector', function () {
  it('uses the default value when passedValue is null/undefined and the env var does not exist', function () {
    expect((0, _utils.getSnippetSelector)()).toBe(_utils.snippetSelector);
  });
});
describe('logIt', function () {
  it('does not call console.log when 2nd arg passed is true', function () {
    (0, _utils.logIt)('message', true);
    expect(console.log).not.toHaveBeenCalled();
  });
  it('calls console.log when 2nd arg passed is false', function () {
    (0, _utils.logIt)('message', false);
    expect(console.log).toHaveBeenCalled();
  });
});
describe('saveToFile', function () {
  it('does not call fs.writeFile when output (1st arg) is undefined', function () {
    (0, _utils.saveToFile)();
    expect(_fs.default.writeFile).not.toHaveBeenCalled();
  });
  it('calls fs.writeFile when output exists, and console.error when an error occurs', function () {
    (0, _utils.saveToFile)('/path/to/output.json', []);
    expect(_fs.default.writeFile).toHaveBeenCalled();
    expect(console.error).toHaveBeenCalled();
  });
  it('does not call console.error when an error does not occur', function () {
    _fs.default.writeFile.mockImplementationOnce(function (path, data, options, cb) {
      cb(false);
    });

    console.error.mockClear();
    (0, _utils.saveToFile)('/path/to/output.json', []);
    expect(console.error).not.toHaveBeenCalled();
  });
});
describe('saveResponse', function () {
  it('does not call fs.writeFile when htmlFileOutputPath (2nd arg) is falsy', function () {
    _fs.default.writeFile.mockClear();

    (0, _utils.saveResponse)('random response that will not make any difference', false);
    expect(_fs.default.writeFile).not.toHaveBeenCalled();
  });
  it('calls fs.writeFile when htmlFileOutputPath exists', function () {
    _fs.default.writeFile.mockClear();

    _fs.default.writeFile.mockImplementationOnce(function (path, data, cb) {
      cb(false);
    });

    (0, _utils.saveResponse)('foo', '/path/to/my/meaningless/response.xml');
    expect(_fs.default.writeFile).toHaveBeenCalled();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInV0aWxzLnNwZWMuanMiXSwibmFtZXMiOlsiamVzdCIsIm1vY2siLCJ3cml0ZUZpbGUiLCJmbiIsInBhdGgiLCJkYXRhIiwib3B0aW9ucyIsImNiIiwiZ2xvYmFsIiwiY29uc29sZSIsImxvZyIsImVycm9yIiwiZGVzY3JpYmUiLCJpdCIsInJlcXVlc3RPcHRpb25zIiwicXVlcnkiLCJleHBlY3QiLCJ0b0VxdWFsIiwidXJsIiwicXMiLCJxIiwibnVtIiwiZGVmYXVsdExpbWl0Iiwic3RhcnQiLCJkZWZhdWx0U3RhcnQiLCJoZWFkZXJzIiwiZGVmYXVsdFVzZXJBZ2VudCIsInRvQmUiLCJ0aXRsZVNlbGVjdG9yIiwibGlua1NlbGVjdG9yIiwic25pcHBldFNlbGVjdG9yIiwibm90IiwidG9IYXZlQmVlbkNhbGxlZCIsImZzIiwibW9ja0ltcGxlbWVudGF0aW9uT25jZSIsIm1vY2tDbGVhciJdLCJtYXBwaW5ncyI6Ijs7QUF5QkFBLElBQUksQ0FBQ0MsSUFBTCxDQUFVLElBQVYsRUFBZ0I7QUFBQSxTQUFPO0FBQ3JCQyxJQUFBQSxTQUFTLEVBQUVGLElBQUksQ0FBQ0csRUFBTCxDQUFRLFVBQUNDLElBQUQsRUFBT0MsSUFBUCxFQUFhQyxPQUFiLEVBQXNCQyxFQUF0QixFQUE2QjtBQUM5QztBQUNBQSxNQUFBQSxFQUFFLENBQUMsSUFBRCxDQUFGO0FBQ0QsS0FIVTtBQURVLEdBQVA7QUFBQSxDQUFoQjs7QUF2QkE7O0FBRUE7Ozs7QUFKQTs7QUFDQTtBQW1CQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBQ2ZDLEVBQUFBLEdBQUcsRUFBRVYsSUFBSSxDQUFDRyxFQUFMLEVBRFU7QUFFZlEsRUFBQUEsS0FBSyxFQUFFWCxJQUFJLENBQUNHLEVBQUw7QUFGUSxDQUFqQjtBQVlBUyxRQUFRLENBQUMsMEJBQUQsRUFBNkIsWUFBTTtBQUN6Q0MsRUFBQUEsRUFBRSxDQUFDLHdFQUFELEVBQTJFLFlBQU07QUFDakYsUUFBTUMsY0FBYyxHQUFHLHFDQUF5QjtBQUFF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VCxDQUFOLENBQXNCb0IsR0FBdEIsQ0FBMEJDLGdCQUExQjtBQUNELEdBUEMsQ0FBRjtBQVFELENBcEJPLENBQVI7QUFzQkFwQixRQUFRLENBQUMsY0FBRCxFQUFpQixZQUFNO0FBQzdCQyxFQUFBQSxFQUFFLENBQUMsdUVBQUQsRUFBMEUsWUFBTTtBQUNoRm9CLGdCQUFHL0IsU0FBSCxDQUFhaUMsU0FBYjs7QUFDQSw2QkFBYSxtREFBYixFQUFrRSxLQUFsRTtBQUNBbkIsSUFBQUEsTUFBTSxDQUFDaUIsWUFBRy9CLFNBQUosQ0FBTixDQUFxQjZCLEdBQXJCLENBQXlCQyxnQkFBekI7QUFDRCxHQUpDLENBQUY7QUFNQW5CLEVBQUFBLEVBQUUsQ0FBQyxtREFBRCxFQUFzRCxZQUFNO0FBQzVEb0IsZ0JBQUcvQixTQUFILENBQWFpQyxTQUFiOztBQUNBRixnQkFBRy9CLFNBQUgsQ0FBYWdDLHNCQUFiLENBQW9DLFVBQUM5QixJQUFELEVBQU9DLElBQVAsRUFBYUUsRUFBYixFQUFvQjtBQUN0REEsTUFBQUEsRUFBRSxDQUFDLEtBQUQsQ0FBRjtBQUNELEtBRkQ7O0FBR0EsNkJBQWEsS0FBYixFQUFvQixzQ0FBcEI7QUFDQVMsSUFBQUEsTUFBTSxDQUFDaUIsWUFBRy9CLFNBQUosQ0FBTixDQUFxQjhCLGdCQUFyQjtBQUNELEdBUEMsQ0FBRjtBQVFELENBZk8sQ0FBUiIsInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG1heC1wYXJhbXMgKi9cbi8qIGVzbGludC1kaXNhYmxlIG5vLWNvbnNvbGUgKi9cbmltcG9ydCBmcyBmcm9tICdmcyc7XG5cbmltcG9ydCB7XG4gIGdldERlZmF1bHRSZXF1ZXN0T3B0aW9ucyxcbiAgZ2V0VGl0bGVTZWxlY3RvcixcbiAgZ2V0TGlua1NlbGVjdG9yLFxuICBnZXRTbmlwcGV0U2VsZWN0b3IsXG4gIGRlZmF1bHRMaW1pdCxcbiAgZGVmYXVsdFN0YXJ0LFxuICBkZWZhdWx0VXNlckFnZW50LFxuICB0aXRsZVNlbGVjdG9yLFxuICBsaW5rU2VsZWN0b3IsXG4gIHNuaXBwZXRTZWxlY3RvcixcbiAgbG9nSXQsXG4gIHNhdmVUb0ZpbGUsXG4gIHNhdmVSZXNwb25zZSxcbn0gZnJvbSAnLi4vc3JjL3V0aWxzJztcblxuZ2xvYmFsLmNvbnNvbGUgPSB7XG4gIGxvZzogamVzdC5mbigpLFxuICBlcnJvcjogamVzdC5mbigpLFxufTtcblxuamVzdC5tb2NrKCdmcycsICgpID0+ICh7XG4gIHdyaXRlRmlsZTogamVzdC5mbigocGF0aCwgZGF0YSwgb3B0aW9ucywgY2IpID0+IHtcbiAgICAvLyAxc3QgYXJnIHBhc3NlZCB0byBjYWxsYmFjayBpcyB0aGUgZXJyb3JcbiAgICBjYih0cnVlKTtcbiAgfSksXG59KSk7XG5cbmRlc2NyaWJlKCdnZXREZWZhdWx0UmVxdWVzdE9wdGlvbnMnLCAoKSA9PiB7XG4gIGl0KCd1c2VzIGRlZmF1bHQgbGltaXQsIHN0YXJ0LCBhbmQgdXNlckFnZW50IHdoZW4gbm9uZSBvZiB0aG9zZSBhcmUgcGFzc2VkJywgKCkgPT4ge1xuICAgIGNvbnN0IHJlcXVlc3RPcHRpb25zID0gZ2V0RGVmYXVsdFJlcXVlc3RPcHRpb25zKHsgcXVlcnk6ICdmb28nIH0pO1xuICAgIGV4cGVjdChyZXF1ZXN0T3B0aW9ucykudG9FcXVhbCh7XG4gICAgICB1cmw6ICdodHRwczovL3d3dy5nb29nbGUuY29tL3NlYXJjaCcsXG4gICAgICBxczoge1xuICAgICAgICBxOiAnZm9vJyxcbiAgICAgICAgbnVtOiBkZWZhdWx0TGltaXQsXG4gICAgICAgIHN0YXJ0OiBkZWZhdWx0U3RhcnQsXG4gICAgICB9LFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnVXNlci1BZ2VudCc6IGRlZmF1bHRVc2VyQWdlbnQsXG4gICAgICB9LFxuICAgIH0pO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnZ2V0VGl0bGVTZWxlY3RvcicsICgpID0+IHtcbiAgaXQoJ3VzZXMgdGhlIGRlZmF1bHQgdmFsdWUgd2hlbiBwYXNzZWRWYWx1ZSBpcyBudWxsL3VuZGVmaW5lZCBhbmQgdGhlIGVudiB2YXIgZG9lcyBub3QgZXhpc3QnLCAoKSA9PiB7XG4gICAgZXhwZWN0KGdldFRpdGxlU2VsZWN0b3IoKSkudG9CZSh0aXRsZVNlbGVjdG9yKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ2dldExpbmtTZWxlY3RvcicsICgpID0+IHtcbiAgaXQoJ3VzZXMgdGhlIGRlZmF1bHQgdmFsdWUgd2hlbiBwYXNzZWRWYWx1ZSBpcyBudWxsL3VuZGVmaW5lZCBhbmQgdGhlIGVudiB2YXIgZG9lcyBub3QgZXhpc3QnLCAoKSA9PiB7XG4gICAgZXhwZWN0KGdldExpbmtTZWxlY3RvcigpKS50b0JlKGxpbmtTZWxlY3Rvcik7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdnZXRTbmlwcGV0U2VsZWN0b3InLCAoKSA9PiB7XG4gIGl0KCd1c2VzIHRoZSBkZWZhdWx0IHZhbHVlIHdoZW4gcGFzc2VkVmFsdWUgaXMgbnVsbC91bmRlZmluZWQgYW5kIHRoZSBlbnYgdmFyIGRvZXMgbm90IGV4aXN0JywgKCkgPT4ge1xuICAgIGV4cGVjdChnZXRTbmlwcGV0U2VsZWN0b3IoKSkudG9CZShzbmlwcGV0U2VsZWN0b3IpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnbG9nSXQnLCAoKSA9PiB7XG4gIGl0KCdkb2VzIG5vdCBjYWxsIGNvbnNvbGUubG9nIHdoZW4gMm5kIGFyZyBwYXNzZWQgaXMgdHJ1ZScsICgpID0+IHtcbiAgICBsb2dJdCgnbWVzc2FnZScsIHRydWUpO1xuICAgIGV4cGVjdChjb25zb2xlLmxvZykubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG5cbiAgaXQoJ2NhbGxzIGNvbnNvbGUubG9nIHdoZW4gMm5kIGFyZyBwYXNzZWQgaXMgZmFsc2UnLCAoKSA9PiB7XG4gICAgbG9nSXQoJ21lc3NhZ2UnLCBmYWxzZSk7XG4gICAgZXhwZWN0KGNvbnNvbGUubG9nKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdzYXZlVG9GaWxlJywgKCkgPT4ge1xuICBpdCgnZG9lcyBub3QgY2FsbCBmcy53cml0ZUZpbGUgd2hlbiBvdXRwdXQgKDFzdCBhcmcpIGlzIHVuZGVmaW5lZCcsICgpID0+IHtcbiAgICBzYXZlVG9GaWxlKCk7XG4gICAgZXhwZWN0KGZzLndyaXRlRmlsZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG5cbiAgaXQoJ2NhbGxzIGZzLndyaXRlRmlsZSB3aGVuIG91dHB1dCBleGlzdHMsIGFuZCBjb25zb2xlLmVycm9yIHdoZW4gYW4gZXJyb3Igb2NjdXJzJywgKCkgPT4ge1xuICAgIHNhdmVUb0ZpbGUoJy9wYXRoL3RvL291dHB1dC5qc29uJywgW10pO1xuICAgIGV4cGVjdChmcy53cml0ZUZpbGUpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICBleHBlY3QoY29uc29sZS5lcnJvcikudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBpdCgnZG9lcyBub3QgY2FsbCBjb25zb2xlLmVycm9yIHdoZW4gYW4gZXJyb3IgZG9lcyBub3Qgb2NjdXInLCAoKSA9PiB7XG4gICAgZnMud3JpdGVGaWxlLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKHBhdGgsIGRhdGEsIG9wdGlvbnMsIGNiKSA9PiB7XG4gICAgICBjYihmYWxzZSk7XG4gICAgfSk7XG4gICAgY29uc29sZS5lcnJvci5tb2NrQ2xlYXIoKTtcbiAgICBzYXZlVG9GaWxlKCcvcGF0aC90by9vdXRwdXQuanNvbicsIFtdKTtcbiAgICBleHBlY3QoY29uc29sZS5lcnJvcikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgfSk7XG59KTtcblxuZGVzY3JpYmUoJ3NhdmVSZXNwb25zZScsICgpID0+IHtcbiAgaXQoJ2RvZXMgbm90IGNhbGwgZnMud3JpdGVGaWxlIHdoZW4gaHRtbEZpbGVPdXRwdXRQYXRoICgybmQgYXJnKSBpcyBmYWxzeScsICgpID0+IHtcbiAgICBmcy53cml0ZUZpbGUubW9ja0NsZWFyKCk7XG4gICAgc2F2ZVJlc3BvbnNlKCdyYW5kb20gcmVzcG9uc2UgdGhhdCB3aWxsIG5vdCBtYWtlIGFueSBkaWZmZXJlbmNlJywgZmFsc2UpO1xuICAgIGV4cGVjdChmcy53cml0ZUZpbGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xuXG4gIGl0KCdjYWxscyBmcy53cml0ZUZpbGUgd2hlbiBodG1sRmlsZU91dHB1dFBhdGggZXhpc3RzJywgKCkgPT4ge1xuICAgIGZzLndyaXRlRmlsZS5tb2NrQ2xlYXIoKTtcbiAgICBmcy53cml0ZUZpbGUubW9ja0ltcGxlbWVudGF0aW9uT25jZSgocGF0aCwgZGF0YSwgY2IpID0+IHtcbiAgICAgIGNiKGZhbHNlKTtcbiAgICB9KTtcbiAgICBzYXZlUmVzcG9uc2UoJ2ZvbycsICcvcGF0aC90by9teS9tZWFuaW5nbGVzcy9yZXNwb25zZS54bWwnKTtcbiAgICBleHBlY3QoZnMud3JpdGVGaWxlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gIH0pO1xufSk7XG4iXX0=